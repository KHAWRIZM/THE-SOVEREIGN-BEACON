<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Sovereign Vault | AES-256</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <style>body { overflow: auto; }</style>
</head>
<body>
    <div class="container" style="display:block;max-width:800px;margin:50px auto;">
        <div class="box header">
            <h1>๐ ุงููุจู ุงูุนุณูุฑู (AES-GCM)</h1>
            <p>ุชุดููุฑ ุญูููู ุจูุนูุงุฑ AES-256. ููุชุงุญู ูู ุณุฑู.</p>
        </div>
        
        <div class="box" style="margin-top:20px;">
            <input type="password" id="key" placeholder="๐ ุฃุฏุฎู ููุชุงุญ ุงูุชุดููุฑ ุงูุณุฑู (Password)..." style="margin-bottom:10px;border-color:#ce0000;">
            <textarea id="text" placeholder="ุงูุชุจ ุงููุต ููุง..." style="width:100%;height:100px;background:#111;color:#fff;border:1px solid #0f0;padding:10px;"></textarea>
            
            <button onclick="process('encrypt')">๐ ุชุดููุฑ (ENCRYPT)</button>
            <button onclick="process('decrypt')" style="background:#ce0000;color:#fff;">๐ ูู ุชุดููุฑ (DECRYPT)</button>
        </div>

        <div class="box" style="margin-top:20px;">
            <h3>ุงููุชูุฌุฉ:</h3>
            <div id="output" style="word-break:break-all;color:#0f0;font-family:monospace;">...</div>
        </div>
        <a href="index.html" style="color:#0f0;">[ ุนูุฏุฉ ]</a>
    </div>

    <script>
        async function process(mode) {
            const pwd = document.getElementById('key').value;
            const text = document.getElementById('text').value;
            const out = document.getElementById('output');
            
            if(!pwd) { alert('ูุฌุจ ูุถุน ูููุฉ ุณุฑ!'); return; }

            const enc = new TextEncoder();
            const keyMaterial = await window.crypto.subtle.importKey("raw", enc.encode(pwd), "PBKDF2", false, ["deriveKey"]);
            const key = await window.crypto.subtle.deriveKey({name: "PBKDF2", salt: enc.encode("SovereignSalt"), iterations: 100000, hash: "SHA-256"}, keyMaterial, {name: "AES-GCM", length: 256}, true, ["encrypt", "decrypt"]);

            if (mode === 'encrypt') {
                const iv = window.crypto.getRandomValues(new Uint8Array(12));
                const encrypted = await window.crypto.subtle.encrypt({name: "AES-GCM", iv: iv}, key, enc.encode(text));
                const ivHex = Array.from(iv).map(b => b.toString(16).padStart(2, '0')).join('');
                const encHex = Array.from(new Uint8Array(encrypted)).map(b => b.toString(16).padStart(2, '0')).join('');
                out.innerText = ivHex + ':' + encHex;
            } else {
                try {
                    const parts = text.split(':');
                    const iv = new Uint8Array(parts[0].match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
                    const data = new Uint8Array(parts[1].match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
                    const decrypted = await window.crypto.subtle.decrypt({name: "AES-GCM", iv: iv}, key, data);
                    out.innerText = new TextDecoder().decode(decrypted);
                } catch(e) { out.innerText = 'โ ูุดู ูู ุงูุชุดููุฑ (ูููุฉ ุงูุณุฑ ุฎุทุฃ)'; }
            }
        }
    </script>
</body>
</html>
