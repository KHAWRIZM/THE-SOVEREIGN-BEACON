// DRAGON403 AI Chat API - Azure Functions Style
// ูููู ูุดุฑู ูู Azure Function ุฃู Serverless

const SYSTEM_PROMPT = `ุฃูุช DRAGON403ุ ูุณุงุนุฏ ุงูุชุญููู ุงูุฑููู ุงูุณูุงุฏู. ูุชุฎุตุต ูู:
- ุชุญููู ุงูุฃุฏูุฉ ุงูุฑูููุฉ (Digital Forensics)
- ุชุชุจุน ุงูุงุญุชูุงู ุงูุฅููุชุฑููู ูุงูุฌุฑุงุฆู ุงููุงููุฉ
- ุชุญููู ุณุฌูุงุช ุงูุดุจูุฉ ูุงูุชุทุจููุงุช
- ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ุงููุตููุฉ ูู ุงููููุงุช
- ุชุญููู ุงูู JWT ูุตูุงุญูุงุช API
- ูุญุต ุนูุงููู IP ูุงูู ASN
- ุชุญููู ุงูู TTP (ุงูุชูุชููุงุช ูุงูุชูููุงุช ูุงูุฅุฌุฑุงุกุงุช)

ุฃูุช ุชุฏุนู ุงููุญูููู ูู ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ. ุชุฌูุจ ุจุงูุนุฑุจูุฉ ุงูุชุฑุงุถูุงู.
ูู ุฏูููุงู ูููููุงู. ูุฏู ุชุญูููุงุช ูุงุจูุฉ ููุชูููุฐ.`;

// ูุญุงูุงุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุนุฑุถ (ููุณุชุจุฏู ุจู Azure OpenAI)
export function generateForensicResponse(userMessage, context = {}) {
  const lowerMsg = userMessage.toLowerCase();
  
  // ุชุญููู JWT
  if (lowerMsg.includes('jwt') ; lowerMsg.includes('token')) {
    return {
      text: \`๐ **ุชุญููู JWT:**

ุฃุณุชุทูุน ุชุญููู ุงูู JWT ูู. ุฃุฑุณู ุงูู Token ูุณุฃุณุชุฎุฑุฌ:
- Header (ุงูุฎูุงุฑุฒููุฉ ูุงูููุน)
- Payload (ุงูุจูุงูุงุช ูุงูุตูุงุญูุงุช)
- ุงูุชูููุช (iat, exp, nbf)
- ุงูุชุญูู ูู ุงูุตูุงุญูุฉ

โ๏ธ **ุชูุจูู ุฃููู:** ูุง ุชุฑุณู tokens ุญููููุฉ ูู ุจูุฆุฉ ุบูุฑ ุขููุฉ.\`,
      type: 'forensic',
      tools: ['jwt-decoder', 'timestamp-analyzer']
    };
  }
  
  // ุชุญููู IP
  if (lowerMsg.includes('ip') ; lowerMsg.includes('ุนููุงู') ; lowerMsg.match(/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/)) {
    const ipMatch = userMessage.match(/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/);
    return {
      text: \`๐ **ุชุญููู ุนููุงู IP${ipMatch ? ': ' + ipMatch[0] : ''}:**

ุณุฃุฌุฑู ุงูุชุญููู ุงูุชุงูู:
- **Geolocation:** ุงููููุน ุงูุฌุบุฑุงูู
- **ASN:** ุฑูู ุงููุธุงู ุงููุณุชูู
- **ISP:** ูุฒูุฏ ุงูุฎุฏูุฉ
- **Reputation:** ุงูุณูุนุฉ ูุงูุชูุฏูุฏุงุช ุงููุฑุชุจุทุฉ
- **WHOIS:** ุจูุงูุงุช ุงูุชุณุฌูู

${ipMatch ? '๐ ุฌุงุฑู ุงูุชุญููู...' : '๐ ุฃุฑุณู ุนููุงู IP ููุชุญููู'}\`,
      type: 'forensic',
      tools: ['ip-lookup', 'asn-resolver', 'threat-intel']
    };
  }
  
  // ุชุญููู Hash
  if (lowerMsg.includes('hash') ; lowerMsg.includes('sha') ; lowerMsg.includes('md5')) {
    return {
      text: \`๐ **ุชุญููู Hash:**

ุฃุณุชุทูุน ุงูุชุญูู ูู:
- **SHA-256/SHA-1/MD5:** ูุทุงุจูุฉ ุงูุฃุฏูุฉ
- **VirusTotal:** ูุญุต ุงููููุงุช ุงูุฎุจูุซุฉ
- **ุณูุณูุฉ ุงูุญูุธ:** ุงูุชุญูู ูู ุณูุงูุฉ ุงูุฃุฏูุฉ

๐ ุฃุฑุณู ุงูู Hash ุฃู ุงุฑูุน ุงูููู ููุชุญููู.\`,
      type: 'forensic',
      tools: ['hash-verify', 'vt-lookup']
    };
  }
  
  // ุงุญุชูุงู ูุงูู
  if (lowerMsg.includes('ุงุญุชูุงู') ; lowerMsg.includes('ูุตุจ') ; lowerMsg.includes('fraud')) {
    return {
      text: \`โ๏ธ **ุชุญููู ุญุงูุฉ ุงุญุชูุงู:**

ูุชุญููู ุงููุถูุฉุ ุฃุญุชุงุฌ:
1. **ุงููุนุงููุงุช ุงููุงููุฉ:** ุชูุงุฑูุฎ ููุจุงูุบ
2. **ุงููููุงุช:** ุชุทุจูู/ูููุน/ุชุญููู ุจููู
3. **ุงูุจูุงูุงุช:** ุฃุฑูุงู ุญุณุงุจุงุชุ ุฑูุงุจุทุ ุฑุณุงุฆู
4. **ุงูุถุญุงูุง:** ุนุฏุฏ ุงููุชุถุฑุฑูู

๐ **ุฅุญุตุงุฆูุงุช DRAGON403:**
- 8.4M+ ุถุญูุฉ ููุซูุฉ
- $600K+ ุฎุณุงุฆุฑ ูุฑุตูุฏุฉ
- 47 ุฏููู ุฑููู ูุคูุฏ

๐ฏ ุฃุฑุณู ุงูุชูุงุตูู ูุจุฏุก ุงูุชุญููู.\`,
      type: 'investigation',
      priority: 'P0'
    };
  }
  
  // ุชุญููู ูููุงุช
  if (lowerMsg.includes('ููู') ; lowerMsg.includes('file') ; lowerMsg.includes('metadata')) {
    return {
      text: \`๐ **ุชุญููู ุงููููุงุช ุงูุฑูููุฉ:**

ุฃุณุชุทูุน ุงุณุชุฎุฑุงุฌ:
- **Metadata:** ุงูุจูุงูุงุช ุงููุตููุฉ
- **EXIF:** ููุตูุฑ (ุงููููุนุ ุงูุฌูุงุฒุ ุงูุชุงุฑูุฎ)
- **Office:** ูููุณุชูุฏุงุช (ุงููุคููุ ุงูุชุนุฏููุงุช)
- **PDF:** ุงูุชูููุนุงุช ูุงูุชุนุฏููุงุช ุงููุฎููุฉ

๐ ุงุฑูุน ุงูููู ุฃู ุฃุฑุณู ุฑุงุจุทู.\`,
      type: 'forensic',
      tools: ['exif-extract', 'metadata-parser']
    };
  }
  
  // ุณุฌูุงุช
  if (lowerMsg.includes('log') ; lowerMsg.includes('ุณุฌู')) {
    return {
      text: \`๐ **ุชุญููู ุงูุณุฌูุงุช:**

ุฃุญูู ุฃููุงุน ุงูุณุฌูุงุช:
- **Apache/Nginx:** ุณุฌูุงุช ุงูููุจ
- **Windows Event:** ุฃุญุฏุงุซ ุงููุธุงู
- **Firewall:** ุฌุฏุงุฑ ุงูุญูุงูุฉ
- **Application:** ุณุฌูุงุช ุงูุชุทุจููุงุช

๐ ุฃุฑุณู ูููุฐุฌ ูู ุงูุณุฌู ููุชุญููู.\`,
      type: 'forensic',
      tools: ['log-parser', 'anomaly-detector']
    };
  }
  
  // ุฑุฏ ุงูุชุฑุงุถู
  return {
    text: \`๐ก๏ธ **DRAGON403 ุฌุงูุฒ ูููุณุงุนุฏุฉ**

ุฃูุง ูุชุฎุตุต ูู ุงูุชุญููู ุงูุฑููู. ุฃุณุชุทูุน:

**๐ ุชุญููู ุงูุฃุฏูุฉ:**
- JWT Tokens ู API Keys
- ุนูุงููู IP ูุชุชุจุน ุงูุดุจูุงุช
- Hash verification ูููููุงุช
- Metadata extraction

**โ๏ธ ุงูุชุญูููุงุช:**
- ุญุงูุงุช ุงูุงุญุชูุงู ุงููุงูู
- ุชุญููู ุงูุชูุฏูุฏุงุช ุงูุณูุจุฑุงููุฉ
- ุชุชุจุน ุงููุนุงููุงุช ุงููุดุจููุฉ

**๐ ุงูุฃุฏูุงุช:**
- ุชุญููู ุงูุณุฌูุงุช
- ูุญุต ุงูุฑูุงุจุท ูุงููููุงุช
- ุงูุชุญูู ูู ุงููููุฉ ุงูุฑูููุฉ

๐ฌ ููู ุฃุณุงุนุฏู ุงููููุ\`,
    type: 'help'
  };
}

// ุชุตุฏูุฑ ููุงุณุชุฎุฏุงู
export default { generateForensicResponse, SYSTEM_PROMPT };
