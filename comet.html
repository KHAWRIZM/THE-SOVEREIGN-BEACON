<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Comet-X | شات مشفر</title>
    <link rel="stylesheet" href="css/platinum.css">
    <style>
        #chat-box { height: 300px; border: 1px solid #333; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.3); margin-bottom: 10px; }
        .msg { margin-bottom: 5px; padding: 5px; border-radius: 3px; }
        .msg.mine { background: rgba(0,255,255,0.1); text-align: left; }
        .msg.others { background: rgba(255,255,255,0.05); }
    </style>
</head>
<body>
    <div class="scanline"></div>
    <div class="container" style="display:block;max-width:600px;margin:30px auto;">
        <div class="box header" style="text-align:center;">
            <h1>☄️ COMET-X LINK</h1>
            <p>قناة اتصال محلية مشفرة (Local Mesh)</p>
        </div>

        <div class="box" style="margin-top:20px;">
            <div id="chat-box"></div>
            <div style="display:flex;gap:10px;">
                <input type="text" id="msgInput" placeholder="اكتب رسالة مشفرة..." onkeypress="if(event.keyCode==13) send()">
                <button onclick="send()">إرسال ⚡</button>
            </div>
        </div>

        <br>
        <a href="index.html" style="color:var(--platinum);text-decoration:none;">[ عودة للقاعدة ]</a>
    </div>

    <script>
        // استخدام BroadcastChannel للاتصال بين التبويبات/الأجهزة المحلية
        const channel = new BroadcastChannel('sovereign_comet');
        const box = document.getElementById('chat-box');

        channel.onmessage = (ev) => {
            appendMsg(ev.data, 'others');
        };

        function send() {
            const input = document.getElementById('msgInput');
            const txt = input.value;
            if(!txt) return;
            
            channel.postMessage(txt);
            appendMsg(txt, 'mine');
            input.value = '';
        }

        function appendMsg(txt, type) {
            const div = document.createElement('div');
            div.className = 'msg ' + type;
            div.innerText = (type==='mine' ? 'أنا: ' : 'مجهول: ') + txt;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }
    </script>
</body>
</html>
